{% extends "base.html" %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <p class="text-xs uppercase tracking-[0.3em] text-slate-400 mb-1">History</p>
        <h1 class="text-2xl font-semibold">Everything that's been logged</h1>
        <p class="text-slate-400 text-sm">Filter by task or date range to audit chores.</p>
    </div>
</div>

<form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-6 text-sm">
    <select name="task" class="bg-slate-900 border border-white/5 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/40">
        <option value="">All tasks</option>
        {% for t in tasks %}
        <option value="{{ t.slug }}" {% if selected_task == t.slug %}selected{% endif %}>{{ t.name }}</option>
        {% endfor %}
    </select>
    <input type="date" name="start_date" value="{{ start_date }}" class="bg-slate-900 border border-white/5 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/40" placeholder="Start date">
    <input type="date" name="end_date" value="{{ end_date }}" class="bg-slate-900 border border-white/5 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500/40" placeholder="End date">
    <div class="flex gap-2">
        <button type="submit" class="flex-1 bg-emerald-500/90 hover:bg-emerald-500 text-slate-950 font-semibold px-3 py-2 rounded-xl transition shadow-lg shadow-emerald-500/20">Apply</button>
        <a href="/history" class="px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition border border-white/5">Reset</a>
    </div>
</form>

<div class="space-y-3">
    {% for ev in events %}
    {% set task = task_map.get(ev.task_type_id) %}
    <div class="bg-slate-900/70 border border-white/5 rounded-2xl p-3 flex items-center gap-3 shadow-lg shadow-black/40">
        <div class="h-12 w-12 rounded-2xl bg-slate-800 flex items-center justify-center text-xl">{{ task.icon if task else "ğŸ¾" }}</div>
        <div class="flex-1">
            <p class="font-semibold">{{ task.name if task else "Unknown task" }}</p>
            <p class="text-slate-400 text-sm">{{ ev.note or "No note" }}</p>
        </div>
        <div class="text-right text-sm">
            <p class="text-slate-200">{{ humanize(ev.timestamp) }}</p>
            <p class="text-slate-500">{{ ev.who or "Anon" }} Â· {{ ev.source or "web" }}</p>
        </div>
    </div>
    {% else %}
    <div class="text-slate-400 text-sm">No events match the current filters yet.</div>
    {% endfor %}
</div>
{% endblock %}
